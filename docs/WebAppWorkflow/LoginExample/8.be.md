---
title: "Backend processing"
description: "Cross Team Collaboration"
id: 8-be
---

---

```python
from flask import Flask, request, jsonify
import hashlib
import secrets
from datetime import datetime, timedelta

app = Flask(__name__)

@app.route('/login', methods=['POST'])
def login():
    data = request.get_json()
    email = data.get('email')
    password = data.get('password')
    
    if not email or not password:
        return jsonify({
            'success': False,
            'error': 'Email and password required'
        }), 400
    
    user = database.query(
        "SELECT id, email, password_hash FROM users WHERE email = ?",
        (email,)
    )
    
    if not user:
        return jsonify({
            'success': False,
            'error': 'Invalid credentials'
        }), 401
    
    password_hash = hashlib.sha256(password.encode()).hexdigest()
    
    if password_hash != user['password_hash']:
        return jsonify({
            'success': False,
            'error': 'Invalid credentials'
        }), 401
    
    session_token = secrets.token_hex(32)  
    expires_at = datetime.now() + timedelta(days=1) 
    
    database.execute(
        "INSERT INTO sessions (user_id, token, expires_at) VALUES (?, ?, ?)",
        (user['id'], session_token, expires_at)
    )
    
    return jsonify({
        'success': True,
        'sessionToken': session_token,
        'user': {
            'id': user['id'],
            'email': user['email']
        }
    }), 200
```

### Questions to explore in the code

**Understanding the Request:**

1. What endpoint URL does this code handle and what HTTP method does it accept?
2. What two pieces of data does the backend extract from the request?
3. Why does the backend validate the input again even though the frontend already validated it?

**Database & User Verification:**

4. What information does the database query retrieve about the user?
5. What happens if no user is found with the provided email?
6. How does the backend verify if the password is correct?
7. Why does the code always return "Invalid credentials" instead of specific errors like "User not found" or "Wrong password"?

**Security & Sessions:**

8. What is password hashing and why don't we store plain passwords?
9. What is a session token and how is it generated?
10. How long does the session token remain valid and where in the code can you see it?
11. What information does the backend send back to the frontend after successful login?

___

